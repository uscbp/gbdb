{% extends template_ext %}
{% load staticfiles %}
{% block extrahead %}
    <title>GBDB - {% if form.instance.id%}Edit{% else %}Add{% endif %} Observation Session</title>
    <script type="text/javascript">
    
    function submitObservationSessionForm(url, obs_id)
	    {
	        //document.getElementById('savingMsg').style.display = 'block';
            //document.getElementById('savingOver').style.display = 'block';
	        var frm = $('#observationSessionForm');
	        $.ajax({
	            type: frm.attr('method'),
	            url: url,
	            data: frm.serialize(),
	            success: doneSubmitObservationSession(obs_id),
	            error: function(data) {
	                alert("Something went wrong!");
	            }
	        });
	    }
	    
	    function doneSubmitObservationSession(obs_id){
	    	document.location.href='/gbdb/observation_session/'.concat(obs_id.toString(), '/');
	    }
	    
	</script>
{% endblock %}
{% block content %}
    <div id="detail">
        <h2>{% if form.instance.id %}Edit{% else %}Add{% endif %} Observation Session</h2>
        <form id="observationSessionForm" method="post" action="" enctype="multipart/form-data">
            {{ form.media }}
            {% csrf_token %}
            <table class="tab_panel">
                <tr valign=top>
                    <td width=12%>{{ form.video.label_tag }}</td>
                    <td>{{ form.video }}</td>
                    <td class="myerrors" width=10%>{{ form.video.errors }}</td>
                </tr>
                <tr valign=top>
                    <td>{{ form.date.label_tag }}*</td>
                    <td>{{ form.date }}</td>
                    <td class="myerrors">{{ form.date.errors }}</td>
                </tr>
                <tr valign=top>
                    <td align=top>Saved locations</td>
                    <td>{{ form.saved_locations }}</td>
                    <td class="myerrors">{{ form.saved_locations.errors }}</td>
                </tr>
                <tr valign=top>
                    <td valign=top>{{ form.location_name.label_tag }}*</td>
                    <td>{{ form.location_name }} <a href="" onclick="return createSavedLocation();">Save location</a></td>
                    <td class="myerrors">{{ form.location_name.errors }}</td>
                </tr>
                <tr valign=top>
                    <td valign=top>{{ form.location.label_tag }}*</td>
                    <td>{{ form.location }}</td>
                    <td class="myerrors">{{ form.location.errors }}</td>
                </tr>
                <tr valign=top>
                    <td valign=top>{{ form.notes.label_tag }}</td>
                    <td>{{ form.notes }}</td>
                    <td class="myerrors">{{ form.notes.errors }}</td>
                </tr>
                <tr>
                    <td colspan="3">
                        <div class="myerrors">
                            {{ form.non_field_errors }}
                        </div>
                    </td>
                </tr>
                <tr>
                	<td colspan="3">
                	<br>
		            Behavioral Events can be added once the Observation Session is saved.
		            <br>
		            {{ form.collator }}
		            {% if form.instance.id %}
		            	<input type="button" value="Save" onclick="submitObservationSessionForm('/gbdb/observation_session/{{ object.id }}/edit/', '{{ object.id }}');"/>&nbsp;
		                <input type="button" value="Cancel" onclick="document.getElementById('context_data').innerHTML='';"/>&nbsp;
		            {% else %}
		            	<input type="submit" value="Save" />&nbsp;
		            {% endif %}
		            </td>
		        </tr>
            </table>
        </form>
    </div>
{% endblock %}
