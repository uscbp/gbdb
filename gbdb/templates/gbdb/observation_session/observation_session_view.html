{% extends "base_generic.html" %}
{% load staticfiles %}
{% block extrahead %}
    <title>GBDB - View Observation Session</title>
    <script type="text/javascript">
        function deleteObservationSession()
        {
            if(confirm('This will delete this Observation Session as well as all links to it from other entries. Do you really want to delete the current Observation Session?'))
            {
                var data={'csrfmiddlewaretoken': '{{ csrf_token }}'};
                var args={type:"POST", url:"/gbdb/observation_session/{{ object.id }}/delete/", data: data, complete: doneDelete };
                $.ajax(args);
            }
        }

        function doneDelete()
        {
            document.location.href='/gbdb/';
        }

        function addBehavioralEvent(id, start_time, duration, video, contexts, ethograms, notes)
        {
            var count = $('#behavioral_events').children().length;
            var tmplMarkup = $('#behavioral_event-template').html();
            var compiledTmpl = _.template(tmplMarkup, { idx : count+1, id: id, start_time: start_time,
                duration: duration, video: video, notes: notes, contexts: contexts, ethograms: ethograms});
            $('#behavioral_events').append(compiledTmpl);
        }
    </script>
{% endblock %}
{% block content %}
    <div id="detail">
        <h2>Observation Session</h2>
        <table class="tab_panel">
            <tr valign="top">
                <td colspan="2"><strong>Collator:</strong> {{ object.get_collator_str }}</td>
            </tr>
            <tr valign="top">
                <td colspan="2"><strong>Created:</strong> {{ object.get_created_str }}</td>
            </tr>
            <tr valign="top">
                <td colspan="2"><strong>Last modified by:</strong> {{ object.get_modified_by_str }}</td>
            </tr>
            <tr valign="top">
                <td colspan="2"><strong>Last modified:</strong> {{ object.get_modified_str }}</td>
            </tr>
            <tr valign="top">
                <td colspan="2"><strong>Video:</strong> {{ object.video }}</td>
            </tr>
            <tr valign="top">
                <td colspan="2"><strong>Date:</strong> {{ object.date }}</td>
            </tr>
            <tr valign="top">
                <td colspan="2"><strong>Location:</strong> {{ object.location }}</td>
            </tr>
            <tr valign="top">
                <td colspan="2"><strong>Notes:</strong> {{ object.notes }}</td>
            </tr>
        </table>

        <br>
        <h3>Behavioral Events <a href="#" onclick="return showPopup('Add Behavioral Event',1000,500,'/gbdb/behavioral_event/new/?observation_session={{ object.id }}');">Add new</a></h3>
        <div id="behavioral_events">
            {% for behavioral_event in behavioral_events %}
                <div id="behavioral_event-{{ forloop.counter }}" name="behavioral_event">
                    <table class="tab_panel">
                        <tr>
                            <td><strong><a href="/gbdb/behavioral_event/{{ behavioral_event.id }}/">Event {{ forloop.counter }}</a></strong></td>
                        </tr>
                        <tr>
                            <td><strong>Start time:</strong> {{ behavioral_event.start_time }}</td>
                        </tr>
                        <tr>
                            <td><strong>Duration:</strong> {{ behavioral_event.duration }}</td>
                        </tr>
                        <tr>
                            <td><strong>Contexts:</strong> {% for context in behavioral_event.contexts.all %}{% if forloop.counter0 > 0 %}, {% endif %}{{ context.name }}{% endfor %}</td>
                        </tr>
                        <tr>
                            <td><strong>Ethograms:</strong> {% for ethogram in behavioral_event.ethograms.all %}{% if forloop.counter0 > 0 %}, {% endif %}{{ ethogram.name }}{% endfor %}</td>
                        </tr>
                        <tr>
                            <td><strong>Video:</strong> {{ behavioral_event.video }}</td>
                        </tr>
                        <tr>
                            <td><strong>Notes:</strong> {{ behavioral_event.notes }}</td>
                        </tr>
                    </table>
                </div>
            {% endfor %}
        </div>
        <input type="button" value="Edit" onclick="document.location.href='/gbdb/observation_session/{{object.id}}/edit/';"/>&nbsp;
        <input type="button" value="Delete" onclick="deleteObservationSession()"/>&nbsp;
    </div>
    <script type="text/html" id="behavioral_event-template">
        <div id="behavioral_event-<%= idx %>" name="behavioral_event">
            <table class="tab_panel">
                <tr>
                    <td><strong><a href="/gbdb/behavioral_event/<%= id %>/">Event <%= idx %></a></strong></td>
                </tr>
                <tr>
                    <td><strong>Start time:</strong> <%= start_time %></td>
                </tr>
                <tr>
                    <td><strong>Duration:</strong> <%= duration %></td>
                </tr>
                <tr>
                    <td><strong>Contexts:</strong> <%= contexts %></td>
                </tr>
                <tr>
                    <td><strong>Ethograms:</strong> <%= ethograms %></td>
                </tr>
                <tr>
                    <td><strong>Video:</strong> <%= video %></td>
                </tr>
                <tr>
                    <td><strong>Notes:</strong> <%= notes %></td>
                </tr>
            </table>
        </div>
    </script>
{% endblock %}
